{% set pager__base_class = 'pager' %}

{% set total_pages = pager['#total_pages']|default(items.pages|length) %}
{% set current_page = current|default(1) %}

{% if items %}
  <nav {{ bem(pager__base_class) }} role="navigation" aria-label="Pagination">
    <ul {{ bem('items', [], pager__base_class, ['js-pager__items']) }}>
      
      {# Previous arrow (if not on first page) #}
      {% if items.previous %}
        <li {{ bem('item', ['previous'], pager__base_class) }}>
          <a {{ bem('link', ['previous'], pager__base_class) }} href="{{ items.previous.href }}" title="{{ 'Go to previous page'|t }}" rel="prev"{{ items.previous.attributes|without('href', 'title', 'rel') }}>
            <span {{ bem('visually-hidden') }}>{{ 'Previous page'|t }}</span>
            {% include "@atoms/images/icons/_yds-icon.twig" with {
              icon__name: 'angle-down',
              icon__decorative: true,
              icon__blockname: pager__base_class,
              icon__modifiers: ['previous'],
            } %}
          </a>
        </li>
      {% endif %}

      {# Pagination Logic #}
      {% if total_pages < 4 %}
        {# Simple pagination for <4 pages: just show all pages #}
        {% for key, item in items.pages %}
          {% if current_page == key %}
            <li {{ bem('item', ['desktop'], pager__base_class, ['is-active']) }}>
              <span {{ bem('link', ['current'], pager__base_class, ['is-active']) }}>
                <span {{ bem('visually-hidden') }}>{{ 'Current page'|t }}</span>
                {{ key }}
              </span>
            </li>
          {% else %}
            {% if item.href %}
              <li {{ bem('item', ['desktop'], pager__base_class) }}>
                <a {{ bem('link', [], pager__base_class) }} href="{{ item.href }}" aria-label="{{ 'Page '|t ~ key }}">
                  {{ key }}
                </a>
              </li>
            {% endif %}
          {% endif %}
        {% endfor %}
      {% elseif total_pages == 4 %}
        {# Special case: exactly 4 pages, show all without ellipsis #}
        {% for i in 1..4 %}
          {% if current_page == i %}
            <li {{ bem('item', ['desktop'], pager__base_class, ['is-active']) }}>
              <span {{ bem('link', ['current'], pager__base_class, ['is-active']) }}>
                <span {{ bem('visually-hidden') }}>{{ 'Current page'|t }}</span>
                {{ i }}
              </span>
            </li>
          {% else %}
            <li {{ bem('item', ['desktop'], pager__base_class) }}>
              <a {{ bem('link', [], pager__base_class) }} href="{{ items.pages[i].href }}" aria-label="{{ 'Page '|t ~ i }}">
                {{ i }}
              </a>
            </li>
          {% endif %}
        {% endfor %}
      {% else %}
        {# Complex pagination for 5+ pages #}
        {% if current_page <= 2 %}
          {# Pattern: 1 2 3 ... 10 (current on 1 or 2) #}
          {% for i in 1..3 %}
            {% if current_page == i %}
              <li {{ bem('item', ['desktop'], pager__base_class, ['is-active']) }}>
                <span {{ bem('link', ['current'], pager__base_class, ['is-active']) }}>
                  <span {{ bem('visually-hidden') }}>{{ 'Current page'|t }}</span>
                  {{ i }}
                </span>
              </li>
            {% else %}
              <li {{ bem('item', ['desktop'], pager__base_class) }}>
                <a {{ bem('link', [], pager__base_class) }} href="{{ items.pages[i].href }}" aria-label="{{ 'Page '|t ~ i }}">
                  {{ i }}
                </a>
              </li>
            {% endif %}
          {% endfor %}
          <li {{ bem('item', ['ellipsis'], pager__base_class) }}>
            <span {{ bem('ellipsis', [], pager__base_class) }} aria-hidden="true">...</span>
          </li>
          <li {{ bem('item', ['desktop'], pager__base_class) }}>
            <a {{ bem('link', [], pager__base_class) }} href="{{ items.pages[total_pages].href }}" aria-label="{{ 'Page '|t ~ total_pages }}">
              {{ total_pages }}
            </a>
          </li>
        {% elseif current_page == 3 %}
          {# Pattern: 1 2 3 4 ... 10 (current on 3, show 4th for easy next) #}
          {% for i in 1..4 %}
            {% if current_page == i %}
              <li {{ bem('item', ['desktop'], pager__base_class, ['is-active']) }}>
                <span {{ bem('link', ['current'], pager__base_class, ['is-active']) }}>
                  <span {{ bem('visually-hidden') }}>{{ 'Current page'|t }}</span>
                  {{ i }}
                </span>
              </li>
            {% else %}
              <li {{ bem('item', ['desktop'], pager__base_class) }}>
                <a {{ bem('link', [], pager__base_class) }} href="{{ items.pages[i].href }}" aria-label="{{ 'Page '|t ~ i }}">
                  {{ i }}
                </a>
              </li>
            {% endif %}
          {% endfor %}
          <li {{ bem('item', ['ellipsis'], pager__base_class) }}>
            <span {{ bem('ellipsis', [], pager__base_class) }} aria-hidden="true">...</span>
          </li>
          <li {{ bem('item', ['desktop'], pager__base_class) }}>
            <a {{ bem('link', [], pager__base_class) }} href="{{ items.pages[total_pages].href }}" aria-label="{{ 'Page '|t ~ total_pages }}">
              {{ total_pages }}
            </a>
          </li>
        {% elseif current_page >= (total_pages - 1) %}
          {# Pattern: 1 ... 8 9 10 (current on last 2 pages) #}
          <li {{ bem('item', ['desktop'], pager__base_class) }}>
            <a {{ bem('link', [], pager__base_class) }} href="{{ items.pages[1].href }}" aria-label="{{ 'Page 1'|t }}">
              1
            </a>
          </li>
          <li {{ bem('item', ['ellipsis'], pager__base_class) }}>
            <span {{ bem('ellipsis', [], pager__base_class) }} aria-hidden="true">...</span>
          </li>
          {% for i in (total_pages - 2)..total_pages %}
            {% if current_page == i %}
              <li {{ bem('item', ['desktop'], pager__base_class, ['is-active']) }}>
                <span {{ bem('link', ['current'], pager__base_class, ['is-active']) }}>
                  <span {{ bem('visually-hidden') }}>{{ 'Current page'|t }}</span>
                  {{ i }}
                </span>
              </li>
            {% else %}
              <li {{ bem('item', ['desktop'], pager__base_class) }}>
                <a {{ bem('link', [], pager__base_class) }} href="{{ items.pages[i].href }}" aria-label="{{ 'Page '|t ~ i }}">
                  {{ i }}
                </a>
              </li>
            {% endif %}
          {% endfor %}
        {% elseif current_page == (total_pages - 2) %}
          {# Pattern: 1 ... 7 8 9 10 (current on 3rd from last, show previous for easy back) #}
          <li {{ bem('item', ['desktop'], pager__base_class) }}>
            <a {{ bem('link', [], pager__base_class) }} href="{{ items.pages[1].href }}" aria-label="{{ 'Page 1'|t }}">
              1
            </a>
          </li>
          <li {{ bem('item', ['ellipsis'], pager__base_class) }}>
            <span {{ bem('ellipsis', [], pager__base_class) }} aria-hidden="true">...</span>
          </li>
          {% for i in (total_pages - 3)..total_pages %}
            {% if current_page == i %}
              <li {{ bem('item', ['desktop'], pager__base_class, ['is-active']) }}>
                <span {{ bem('link', ['current'], pager__base_class, ['is-active']) }}>
                  <span {{ bem('visually-hidden') }}>{{ 'Current page'|t }}</span>
                  {{ i }}
                </span>
              </li>
            {% else %}
              <li {{ bem('item', ['desktop'], pager__base_class) }}>
                <a {{ bem('link', [], pager__base_class) }} href="{{ items.pages[i].href }}" aria-label="{{ 'Page '|t ~ i }}">
                  {{ i }}
                </a>
              </li>
            {% endif %}
          {% endfor %}
        {% else %}
          {# Pattern: 1 ... 4 5 6 ... 10 (current in middle) #}
          <li {{ bem('item', ['desktop'], pager__base_class) }}>
            <a {{ bem('link', [], pager__base_class) }} href="{{ items.pages[1].href }}" aria-label="{{ 'Page 1'|t }}">
              1
            </a>
          </li>
          <li {{ bem('item', ['ellipsis'], pager__base_class) }}>
            <span {{ bem('ellipsis', [], pager__base_class) }} aria-hidden="true">...</span>
          </li>
          {% for i in (current_page - 1)..(current_page + 1) %}
            {% if current_page == i %}
              <li {{ bem('item', ['desktop'], pager__base_class, ['is-active']) }}>
                <span {{ bem('link', ['current'], pager__base_class, ['is-active']) }}>
                  <span {{ bem('visually-hidden') }}>{{ 'Current page'|t }}</span>
                  {{ i }}
                </span>
              </li>
            {% else %}
              <li {{ bem('item', ['desktop'], pager__base_class) }}>
                <a {{ bem('link', [], pager__base_class) }} href="{{ items.pages[i].href }}" aria-label="{{ 'Page '|t ~ i }}">
                  {{ i }}
                </a>
              </li>
            {% endif %}
          {% endfor %}
          <li {{ bem('item', ['ellipsis'], pager__base_class) }}>
            <span {{ bem('ellipsis', [], pager__base_class) }} aria-hidden="true">...</span>
          </li>
          <li {{ bem('item', ['desktop'], pager__base_class) }}>
            <a {{ bem('link', [], pager__base_class) }} href="{{ items.pages[total_pages].href }}" aria-label="{{ 'Page '|t ~ total_pages }}">
              {{ total_pages }}
            </a>
          </li>
        {% endif %}
      {% endif %}

      {# Mobile Pager #}
      <li {{ bem('item', ['mobile'], pager__base_class) }}>
        {{ current_page }} / {{ total_pages }}
      </li>

      {# Next arrow (if not on last page) #}
      {% if items.next %}
        <li {{ bem('item', ['next'], pager__base_class) }}>
          <a {{ bem('link', ['next'], pager__base_class) }} href="{{ items.next.href }}" title="{{ 'Go to next page'|t }}" rel="next"{{ items.next.attributes|without('href', 'title', 'rel') }}>
            <span {{ bem('visually-hidden') }}>{{ 'Next page'|t }}</span>
            {% include "@atoms/images/icons/_yds-icon.twig" with {
              icon__name: 'angle-down',
              icon__decorative: true,
              icon__blockname: pager__base_class,
              icon__modifiers: ['next'],
            } %}
          </a>
        </li>
      {% endif %}
    </ul>
  </nav>
{% endif %}
